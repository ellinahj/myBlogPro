{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar _jsxFileName = \"/Users/hj/develop/myproject/myDiary/client/src/components/common/PhotoUpload.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport styled, { css } from 'styled-components';\nimport { useState, useRef, useCallback, useEffect } from 'react';\nimport { useSelector } from 'react-redux';\nimport ReactCrop from 'react-image-crop';\nimport { BlueEditBtn } from '../../utils/theme';\nexport default function Upload(props) {\n  var imgFormData = props.imgFormData,\n      prevImg = props.prevImg,\n      showEdit = props.showEdit,\n      clickEdit = props.clickEdit;\n\n  var _useState = useState([null]),\n      file = _useState[0],\n      setFile = _useState[1];\n\n  var _useState2 = useState([]),\n      upImg = _useState2[0],\n      setUpImg = _useState2[1];\n\n  var _useState3 = useState({\n    unit: '%',\n    width: 100,\n    aspect: 1\n  }),\n      crop = _useState3[0],\n      setCrop = _useState3[1];\n\n  var _useState4 = useState([null]),\n      previewUrl = _useState4[0],\n      setPreviewUrl = _useState4[1];\n\n  var _useState5 = useState(null),\n      index = _useState5[0],\n      setIndex = _useState5[1];\n\n  var _useState6 = useState(''),\n      filename = _useState6[0],\n      setFilename = _useState6[1];\n\n  var _useState7 = useState(''),\n      fileInfo = _useState7[0],\n      setFileInfo = _useState7[1];\n\n  var imgRef = useRef(null);\n  var userColor = useSelector(function (state) {\n    return state.common.userColor;\n  });\n  var userInfo = useSelector(function (state) {\n    return state.common.userInfo;\n  });\n  var inputRefs = useRef([]);\n\n  var controlFileBtn = function controlFileBtn(e, index) {\n    e.preventDefault();\n    inputRefs.current[index].click();\n  };\n\n  var addImg = function addImg(e, index) {\n    setIndex(index);\n\n    if (e.target.files && e.target.files.length > 0) {\n      var reader = new FileReader();\n      reader.addEventListener('load', function () {\n        return setUpImg(reader.result);\n      });\n      reader.readAsDataURL(e.target.files[0]);\n      setFilename(e.target.files[0].name);\n      setFileInfo(e.target.files[0].type);\n    }\n  };\n\n  var onLoad = useCallback(function (img) {\n    imgRef.current = img;\n  }, []);\n\n  var makeClientCrop = function makeClientCrop(crop) {\n    return _regeneratorRuntime.async(function makeClientCrop$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (imgRef.current && crop.width && crop.height) {\n              createCropPreview(imgRef.current, crop, filename);\n            }\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var createCropPreview = function createCropPreview(image, crop, fileName) {\n    var canvas, scaleX, scaleY, ctx;\n    return _regeneratorRuntime.async(function createCropPreview$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            canvas = document.createElement('canvas');\n            scaleX = image.naturalWidth / image.width;\n            scaleY = image.naturalHeight / image.height;\n            canvas.width = crop.width;\n            canvas.height = crop.height;\n            ctx = canvas.getContext('2d');\n            ctx.drawImage(image, crop.x * scaleX, crop.y * scaleY, crop.width * scaleX, crop.height * scaleY, 0, 0, crop.width, crop.height);\n            return _context2.abrupt(\"return\", new Promise(function (resolve, reject) {\n              canvas.toBlob(function (blob) {\n                if (!blob) {\n                  reject(new Error('Canvas is empty'));\n                  return;\n                }\n\n                blob.name = fileName;\n                window.URL.revokeObjectURL(previewUrl);\n\n                var tempPreviewUrl = _toConsumableArray(previewUrl);\n\n                tempPreviewUrl.splice(index, 1, window.URL.createObjectURL(blob));\n                setPreviewUrl(tempPreviewUrl);\n                prevImg(tempPreviewUrl);\n                var blobToFile = new File([blob], filename);\n\n                var tempFile = _toConsumableArray(file);\n\n                tempFile.splice(index, 1, blobToFile);\n                setFile(tempFile);\n              }, fileInfo);\n            })[\"catch\"](function (err) {\n              console.log('blob promise err', err);\n            }));\n\n          case 8:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    imgFormData(file);\n  }, [file]);\n  useEffect(function () {\n    setUpImg([]);\n  }, [showEdit]);\n  return __jsx(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 5\n    }\n  }, __jsx(TitleCenter, {\n    onClick: function onClick(e) {\n      return clickEdit(e);\n    },\n    userColor: userColor,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }\n  }, \"\\uD504\\uB85C\\uD544\\uBCC0\\uACBD\"), __jsx(ProfileRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }\n  }, __jsx(ProfileCenter, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 9\n    }\n  }, showEdit && __jsx(EditWrap, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }\n  }, __jsx(EditImg, {\n    src: '/images/edit.svg',\n    width: 16,\n    onClick: function onClick(e) {\n      return controlFileBtn(e, 0);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 15\n    }\n  })), __jsx(\"input\", {\n    name: \"file\",\n    type: \"file\",\n    accept: \"image/*\",\n    ref: function ref(_ref) {\n      return inputRefs.current[0] = _ref;\n    },\n    style: {\n      display: 'none'\n    },\n    onChange: function onChange(e) {\n      return addImg(e, 0);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 11\n    }\n  }), showEdit && previewUrl && previewUrl[0] ? __jsx(Img, {\n    src: previewUrl[0],\n    width: 70,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }\n  }) : __jsx(Img, {\n    src: userInfo && userInfo.profile_url ? userInfo.profile_url : '/images/default_profile.png',\n    width: 70,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 13\n    }\n  }))), showEdit && __jsx(ProfileRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 9\n    }\n  }, __jsx(ReactCropDiv, {\n    userColor: userColor,\n    src: upImg,\n    onImageLoaded: onLoad,\n    crop: crop,\n    onChange: function onChange(img) {\n      return setCrop(img);\n    },\n    onComplete: makeClientCrop,\n    uploadImg: upImg,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 11\n    }\n  })));\n}\nvar Row = styled.div.withConfig({\n  displayName: \"PhotoUpload__Row\",\n  componentId: \"sc-5k8m7r-0\"\n})([\"display:flex;flex-direction:column;align-items:flex-start;\"]);\nvar PreviewImg = styled.img.withConfig({\n  displayName: \"PhotoUpload__PreviewImg\",\n  componentId: \"sc-5k8m7r-1\"\n})([\"width:100%;\"]);\nvar ImageRow = styled.div.withConfig({\n  displayName: \"PhotoUpload__ImageRow\",\n  componentId: \"sc-5k8m7r-2\"\n})([\"display:flex;flex-direction:column;\"]);\nvar ProfileRow = styled.div.withConfig({\n  displayName: \"PhotoUpload__ProfileRow\",\n  componentId: \"sc-5k8m7r-3\"\n})([\"display:flex;width:100%;justify-content:center;margin:20px 0 20px;\"]);\nvar TitleCenter = styled.div.withConfig({\n  displayName: \"PhotoUpload__TitleCenter\",\n  componentId: \"sc-5k8m7r-4\"\n})([\"display:flex;align-items:center;justify-content:center;width:100%;margin:20px 0;\", \" color:\", \";font-size:\", \";\"], BlueEditBtn, function (props) {\n  return props.userColor;\n}, function (props) {\n  return props.theme.mFont;\n});\nvar ProfileCenter = styled.div.withConfig({\n  displayName: \"PhotoUpload__ProfileCenter\",\n  componentId: \"sc-5k8m7r-5\"\n})([\"display:flex;align-items:center;justify-content:center;position:relative;\"]);\nvar ReactCropDiv = styled(ReactCrop).withConfig({\n  displayName: \"PhotoUpload__ReactCropDiv\",\n  componentId: \"sc-5k8m7r-6\"\n})([\"margin-bottom:\", \";width:\", \";height:\", \";\"], function (props) {\n  return props.uploadImg.length > 0 ? '20px' : '0px';\n}, function (props) {\n  return props.uploadImg.length && '200px';\n}, function (props) {\n  return props.uploadImg.length && '200px';\n});\nvar EditImg = styled.img.withConfig({\n  displayName: \"PhotoUpload__EditImg\",\n  componentId: \"sc-5k8m7r-7\"\n})([\"width:\", \";height:\", \";border-radius:\", \"px;\"], function (props) {\n  return props.width || '30px';\n}, function (props) {\n  return props.width || '30px';\n}, function (props) {\n  return props.width / 2 || 15;\n});\nvar EditWrap = styled.div.withConfig({\n  displayName: \"PhotoUpload__EditWrap\",\n  componentId: \"sc-5k8m7r-8\"\n})([\"cursor:pointer;background-color:#666;position:absolute;bottom:0;left:46px;margin-right:0;width:24px;height:24px;border-radius:12px;display:flex;align-items:center;justify-content:center;\"]);\nvar Img = styled.img.withConfig({\n  displayName: \"PhotoUpload__Img\",\n  componentId: \"sc-5k8m7r-9\"\n})([\"width:\", \";height:\", \";border-radius:\", \"px;margin-right:0;border:1px solid #ddd;\"], function (props) {\n  return props.width || '30px';\n}, function (props) {\n  return props.width || '30px';\n}, function (props) {\n  return props.width / 2 || 15;\n});","map":{"version":3,"sources":["/Users/hj/develop/myproject/myDiary/client/src/components/common/PhotoUpload.js"],"names":["styled","css","useState","useRef","useCallback","useEffect","useSelector","ReactCrop","BlueEditBtn","Upload","props","imgFormData","prevImg","showEdit","clickEdit","file","setFile","upImg","setUpImg","unit","width","aspect","crop","setCrop","previewUrl","setPreviewUrl","index","setIndex","filename","setFilename","fileInfo","setFileInfo","imgRef","userColor","state","common","userInfo","inputRefs","controlFileBtn","e","preventDefault","current","click","addImg","target","files","length","reader","FileReader","addEventListener","result","readAsDataURL","name","type","onLoad","img","makeClientCrop","height","createCropPreview","image","fileName","canvas","document","createElement","scaleX","naturalWidth","scaleY","naturalHeight","ctx","getContext","drawImage","x","y","Promise","resolve","reject","toBlob","blob","Error","window","URL","revokeObjectURL","tempPreviewUrl","splice","createObjectURL","blobToFile","File","tempFile","err","console","log","ref","display","profile_url","Row","div","PreviewImg","ImageRow","ProfileRow","TitleCenter","theme","mFont","ProfileCenter","ReactCropDiv","uploadImg","EditImg","EditWrap","Img"],"mappings":"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","sourcesContent":["import styled, { css } from 'styled-components';\nimport { useState, useRef, useCallback, useEffect } from 'react';\nimport { useSelector } from 'react-redux';\nimport ReactCrop from 'react-image-crop';\nimport { BlueEditBtn } from '../../utils/theme';\n\nexport default function Upload(props) {\n  const { imgFormData, prevImg, showEdit, clickEdit } = props;\n  const [file, setFile] = useState([null]);\n  const [upImg, setUpImg] = useState([]);\n  const [crop, setCrop] = useState({ unit: '%', width: 100, aspect: 1 });\n  const [previewUrl, setPreviewUrl] = useState([null]);\n  const [index, setIndex] = useState(null);\n  const [filename, setFilename] = useState('');\n  const [fileInfo, setFileInfo] = useState('');\n  const imgRef = useRef(null);\n  const userColor = useSelector(state => state.common.userColor);\n  const userInfo = useSelector(state => state.common.userInfo);\n  let inputRefs = useRef([]);\n  const controlFileBtn = (e, index) => {\n    e.preventDefault();\n    inputRefs.current[index].click();\n  };\n\n  const addImg = (e, index) => {\n    setIndex(index);\n    if (e.target.files && e.target.files.length > 0) {\n      const reader = new FileReader();\n      reader.addEventListener('load', () => setUpImg(reader.result));\n      reader.readAsDataURL(e.target.files[0]);\n      setFilename(e.target.files[0].name);\n      setFileInfo(e.target.files[0].type);\n    }\n  };\n\n  const onLoad = useCallback(img => {\n    imgRef.current = img;\n  }, []);\n\n  const makeClientCrop = async crop => {\n    if (imgRef.current && crop.width && crop.height) {\n      createCropPreview(imgRef.current, crop, filename);\n    }\n  };\n\n  const createCropPreview = async (image, crop, fileName) => {\n    const canvas = document.createElement('canvas');\n    const scaleX = image.naturalWidth / image.width;\n    const scaleY = image.naturalHeight / image.height;\n    canvas.width = crop.width;\n    canvas.height = crop.height;\n    const ctx = canvas.getContext('2d');\n\n    ctx.drawImage(\n      image,\n      crop.x * scaleX,\n      crop.y * scaleY,\n      crop.width * scaleX,\n      crop.height * scaleY,\n      0,\n      0,\n      crop.width,\n      crop.height\n    );\n\n    return new Promise((resolve, reject) => {\n      canvas.toBlob(blob => {\n        if (!blob) {\n          reject(new Error('Canvas is empty'));\n          return;\n        }\n        blob.name = fileName;\n        window.URL.revokeObjectURL(previewUrl);\n        const tempPreviewUrl = [...previewUrl];\n        tempPreviewUrl.splice(index, 1, window.URL.createObjectURL(blob));\n        setPreviewUrl(tempPreviewUrl);\n        prevImg(tempPreviewUrl);\n\n        const blobToFile = new File([blob], filename);\n        const tempFile = [...file];\n        tempFile.splice(index, 1, blobToFile);\n        setFile(tempFile);\n      }, fileInfo);\n    }).catch(err => {\n      console.log('blob promise err', err);\n    });\n  };\n  useEffect(() => {\n    imgFormData(file);\n  }, [file]);\n\n  useEffect(() => {\n    setUpImg([]);\n  }, [showEdit]);\n\n  return (\n    <Row>\n      <TitleCenter onClick={e => clickEdit(e)} userColor={userColor}>\n        프로필변경\n      </TitleCenter>\n      <ProfileRow>\n        <ProfileCenter>\n          {showEdit && (\n            <EditWrap>\n              <EditImg src={'/images/edit.svg'} width={16} onClick={e => controlFileBtn(e, 0)} />\n            </EditWrap>\n          )}\n\n          <input\n            name=\"file\"\n            type=\"file\"\n            accept=\"image/*\"\n            ref={ref => (inputRefs.current[0] = ref)}\n            style={{ display: 'none' }}\n            onChange={e => addImg(e, 0)}\n          />\n\n          {showEdit && previewUrl && previewUrl[0] ? (\n            <Img src={previewUrl[0]} width={70} />\n          ) : (\n            <Img\n              src={userInfo && userInfo.profile_url ? userInfo.profile_url : '/images/default_profile.png'}\n              width={70}\n            />\n          )}\n        </ProfileCenter>\n      </ProfileRow>\n      {showEdit && (\n        <ProfileRow>\n          <ReactCropDiv\n            userColor={userColor}\n            src={upImg}\n            onImageLoaded={onLoad}\n            crop={crop}\n            onChange={img => setCrop(img)}\n            onComplete={makeClientCrop}\n            uploadImg={upImg}\n          />\n        </ProfileRow>\n      )}\n    </Row>\n  );\n}\nconst Row = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n`;\nconst PreviewImg = styled.img`\n  width: 100%;\n`;\nconst ImageRow = styled.div`\n  display: flex;\n  flex-direction: column;\n`;\nconst ProfileRow = styled.div`\n  display: flex;\n  width: 100%;\n  justify-content: center;\n  margin: 20px 0 20px;\n`;\nconst TitleCenter = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n  margin: 20px 0;\n${BlueEditBtn}\ncolor:${props => props.userColor};\n  font-size: ${props => props.theme.mFont};\n`;\n\nconst ProfileCenter = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n`;\n\nconst ReactCropDiv = styled(ReactCrop)`\n  margin-bottom: ${props => (props.uploadImg.length > 0 ? '20px' : '0px')};\n  width: ${props => props.uploadImg.length && '200px'};\n  height: ${props => props.uploadImg.length && '200px'};\n`;\nconst EditImg = styled.img`\n  width: ${props => props.width || '30px'};\n  height: ${props => props.width || '30px'};\n  border-radius: ${props => props.width / 2 || 15}px;\n`;\nconst EditWrap = styled.div`\n  cursor: pointer;\n  background-color: #666;\n  position: absolute;\n  bottom: 0;\n  left: 46px;\n  margin-right: 0;\n  width: 24px;\n  height: 24px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\nconst Img = styled.img`\n  width: ${props => props.width || '30px'};\n  height: ${props => props.width || '30px'};\n  border-radius: ${props => props.width / 2 || 15}px;\n  margin-right: 0;\n  border: 1px solid #ddd;\n`;\n"]},"metadata":{},"sourceType":"module"}